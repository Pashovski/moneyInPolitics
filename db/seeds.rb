require 'rest-client'
Legislator.destroy_all
Contribution.destroy_all
def open_secrets_key
    ENV["API_KEY"]
end


def legislator_set
    states = [ 'AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'ND', 'NE', 'NV', 'NH', 'NJ', 'NM', 'NY', 'NC', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY' ]
    api_data = {key: open_secrets_key}
    states.each do |state|
    legislators = RestClient.get("http://www.opensecrets.org/api/?method=getLegislators&id=#{state}&apikey=#{api_data[:key]}")
    hash = Hash.from_xml(legislators)
    # puts hash["response"]["legislator"]
    # puts "#{state} + ***************"
    # legislator_array = JSON.parse(legislators)
    hash["response"]["legislator"].each do |l|
       current_l = Legislator.create(name: l["firstlast"], party: l["party"], website_url: l["website"])
        data = RestClient.get("https://www.opensecrets.org/api/?method=candContrib&cid=#{l["cid"]}&cycle=2020&apikey=#{api_data[:key]}")
        contributions = Hash.from_xml(data)
        # byebug
        contributions["response"]["contributors"]["contributor"].each do |cln| 
            puts cln["org_name"]
            Contribution.create(organization: cln["org_name"], amount: cln["total"].to_i, legislator_id: current_l.id )
        end

        end
    end
end

# def contribution_set
#     cids = ['N00044245',
#         'N00041295',
#         'N00024759',
#         'N00003028',
#         'N00030910',
#         'N00035691',
#         'N00030622',
#         'N00044434',
#         'N00009920',
#         'N00007999',
#         'N00035774',
#         'N00026050',
#         'N00037515',
#         'N00029260',
#         'N00025284',
#         'N00030771',
#         'N00039293',
#         'N00006460',
#         'N00036097',
#         'N00042056',
#         'N00041750',
#         'N00044223',
#         'N00033983',
#         'N00030770',
#         'N00035792',
#         'N00031857',
#         'N00035527',
#         'N00033363',
#         'N00013873',
#         'N00033987',
#         'N00033030',
#         'N00030856',
#         'N00006863',
#         'N00007419',
#         'N00027459',
#         'N00030717',
#         'N00045377',
#         'N00026926',
#         'N00040853',
#         'N00030709',
#         'N00007360',
#         'N00008046',
#         'N00029649',
#         'N00033508',
#         'N00026341',
#         'N00026427',
#         'N00007335',
#         'N00007479',
#         'N00038601',
#         'N00033367',
#         'N00007248',
#         'N00028152',
#         'N00037015',
#         'N00044298',
#         'N00034254',
#         'N00030600',
#         'N00009585',
#         'N00033373',
#         'N00006897',
#         'N00033997',
#         'N00006789',
#         'N00035825',
#         'N00040597',
#         'N00036107',
#         'N00033510',
#         'N00031877',
#         'N00024870',
#         'N00042386',
#         'N00006671',
#         'N00006701',
#         'N00007099',
#         'N00006690',
#         'N00037019',
#         'N00040865',
#         'N00037260',
#         'N00033274',
#         'N00044501',
#         'N00040667',
#         'N00007017',
#         'N00007021',
#         'N00033591',
#         'N00042081',
#         'N00047888',
#         'N00036915',
#         'N00007364',
#         'N00006134',
#         'N00041080',
#         'N00045974',
#         'N00030829',
#         'N00028133',
#         'N00040876',
#         'N00027510',
#         'N00030608',
#         'N00044206',
#         'N00000575',
#         'N00024842',
#         'N00000615',
#         'N00029070',
#         'N00043421',
#         'N00027566',
#         'N00031685',
#         'N00038414',
#         'N00012508',
#         'N00031820',
#         'N00039503',
#         'N00037442',
#         'N00045978',
#         'N00039777',
#         'N00030642',
#         'N00042403',
#         'N00040133',
#         'N00029662',
#         'N00037422',
#         'N00033449',
#         'N00026335',
#         'N00027462',
#         'N00002942',
#         'N00027514',
#         'N00046760',
#         'N00027626',
#         'N00042808',
#         'N00037269',
#         'N00034016',
#         'N00002884',
#         'N00002893',
#         'N00031317',
#         'N00026106',
#         'N00030650',
#         'N00025337',
#         'N00046394',
#         'N00042810',
#         'N00043290',
#         'N00030612',
#         'N00035346',
#         'N00002674',
#         'N00039090',
#         'N00027848',
#         'N00047361',
#         'N00042813',
#         'N00041791',
#         'N00032457',
#         'N00046654',
#         'N00032243',
#         'N00035347',
#         'N00033720',
#         'N00024871',
#         'N00044701',
#         'N00040675',
#         'N00046489',
#         'N00046125',
#         'N00025882',
#         'N00044007',
#         'N00028138',
#         'N00028139',
#         'N00041335',
#         'N00006263',
#         'N00029441',
#         'N00006267',
#         'N00004887',
#         'N00035215',
#         'N00040891',
#         'N00042114',
#         'N00030581',
#         'N00041338',
#         'N00004884',
#         'N00033240',
#         'N00004724',
#         'N00033101',
#         'N00029139',
#         'N00035420',
#         'N00034784',
#         'N00041569',
#         'N00045703',
#         'N00030667',
#         'N00033390',
#         'N00037031',
#         'N00004981',
#         'N00027860',
#         'N00045905',
#         'N00031226',
#         'N00037185',
#         'N00041954',
#         'N00046537',
#         'N00041956',
#         'N00029513',
#         'N00031227',
#         'N00038429',
#         'N00041731',
#         'N00030670',
#         'N00044521',
#         'N00029495',
#         'N00041104',
#         'N00044011',
#         'N00001758',
#         'N00035483',
#         'N00030743',
#         'N00044232',
#         'N00042626',
#         'N00040712',
#         'N00037034',
#         'N00005282',
#         'N00038260',
#         'N00029675',
#         'N00028073',
#         'N00034041',
#         'N00003473',
#         'N00031233',
#         'N00003389',
#         'N00030836',
#         'N00009660',
#         'N00025766',
#         'N00030184',
#         'N00039953',
#         'N00039106',
#         'N00047972',
#         'N00036135',
#         'N00030245',
#         'N00026823',
#         'N00013817',
#         'N00041668',
#         'N00034580',
#         'N00000491',
#         'N00029147',
#         'N00025482',
#         'N00027751',
#         'N00036999',
#         'N00001821',
#         'N00039122',
#         'N00001799',
#         'N00037036',
#         'N00001955',
#         'N00013820',
#         'N00000153',
#         'N00000179',
#         'N00041808',
#         'N00045506',
#         'N00035278',
#         'N00035431',
#         'N00042581',
#         'N00013855',
#         'N00031933',
#         'N00033492',
#         'N00000270',
#         'N00039533',
#         'N00030673',
#         'N00044884',
#         'N00036275',
#         'N00033395',
#         'N00004133',
#         'N00026368',
#         'N00041357',
#         'N00042149',
#         'N00045730',
#         'N00040915',
#         'N00036149',
#         'N00042649',
#         'N00034068',
#         'N00029277',
#         'N00004118',
#         'N00031390',
#         'N00037039',
#         'N00041134',
#         'N00012942',
#         'N00043581',
#         'N00035440',
#         'N00045251',
#         'N00041511',
#         'N00042353',
#         'N00027500',
#         'N00037003',
#         'N00003288',
#         'N00042458',
#         'N00031958',
#         'N00043298',
#         'N00003280',
#         'N00039373',
#         'N00033106',
#         'N00030026',
#         'N00031005',
#         'N00026790',
#         'N00013323',
#         'N00030676',
#         'N00035282',
#         'N00005195',
#         'N00041620',
#         'N00035517',
#         'N00027605',
#         'N00033054',
#         'N00042868',
#         'N00031688',
#         'N00004614',
#         'N00026631',
#         'N00037049',
#         'N00027623',
#         'N00033443',
#         'N00035544',
#         'N00030191',
#         'N00031177',
#         'N00037247',
#         'N00033638',
#         'N00038734',
#         'N00037161',
#         'N00042161',
#         'N00030875',
#         'N00038397',
#         'N00024790',
#         'N00036154',
#         'N00042164',
#         'N00041370',
#         'N00009816',
#         'N00036944',
#         'N00000781',
#         'N00041843',
#         'N00027523',
#         'N00000751',
#         'N00034639',
#         'N00041154',
#         'N00036158',
#         'N00000699',
#         'N00035267',
#         'N00040933',
#         'N00047871',
#         'N00041454',
#         'N00044559',
#         'N00029835',
#         'N00029562',
#         'N00029404',
#         'N00046030',
#         'N00038742',
#         'N00035927',
#         'N00001171',
#         'N00034547',
#         'N00001102',
#         'N00033640',
#         'N00026961',
#         'N00000939',
#         'N00044040',
#         'N00000078',
#         'N00034549',
#         'N00041162',
#         'N00044346',
#         'N00044790',
#         'N00044908',
#         'N00034277',
#         'N00040741',
#         'N00030196',
#         'N00035523',
#         'N00036351',
#         'N00030949',
#         'N00035934',
#         'N00043207',
#         'N00027060',
#         'N00044575',
#         'N00027658',
#         'N00001093',
#         'N00027035',
#         'N00038565',
#         'N00044027',
#         'N00002260',
#         'N00026166',
#         'N00042159',
#         'N00033527',
#         'N00033630',
#         'N00044335',
#         'N00026627',
#         'N00046252',
#         'N00035451',
#         'N00039551',
#         'N00035492',
#         'N00002221',
#         'N00003689',
#         'N00033310',
#         'N00033904',
#         'N00027894',
#         'N00012233',
#         'N00032088',
#         'N00031128',
#         'N00038767',
#         'N00003522',
#         'N00025175',
#         'N00030490',
#         'N00047875',
#         'N00042194',
#         'N00025280',
#         'N00035007',
#         'N00029574',
#         'N00048568',
#         'N00041690',
#         'N00003535',
#         'N00003682',
#         'N00040829',
#         'N00033410',
#         'N00005559',
#         'N00025726',
#         'N00044579',
#         'N00031129',
#         'N00005582',
#         'N00033474',
#         'N00045773',
#         'N00007727',
#         'N00007781',
#         'N00030071',
#         'N00029303',
#         'N00007724',
#         'N00038779',
#         'N00035307',
#         'N00038450',
#         'N00042894',
#         'N00042706',
#         'N00040949',
#         'N00041997',
#         'N00034128',
#         'N00029416',
#         'N00034120',
#         'N00038781',
#         'N00044065',
#         'N00043242',
#         'N00041871',
#         'N00029736',
#         'N00031647',
#         'N00041870',
#         'N00001373',
#         'N00001489',
#         'N00027503',
#         'N00032019',
#         'N00009724',
#         'N00027533',
#         'N00000362',
#         'N00035670',
#         'N00024809',
#         'N00030752',
#         'N00042715',
#         'N00027783',
#         'N00002408',
#         'N00033832',
#         'N00031782',
#         'N00009975',
#         'N00040559',
#         'N00004572',
#         'N00035187',
#         'N00046688',
#         'N00041594',
#         'N00030815',
#         'N00030957',
#         'N00003132',
#         'N00041599',
#         'N00041873',
#         'N00025445',
#         'N00003225',
#         'N00003105',
#         'N00045369',
#         'N00026148',
#         'N00042224',
#         'N00027709',
#         'N00047264',
#         'N00042237',
#         'N00042240',
#         'N00042243',
#         'N00041194',
#         'N00005883',
#         'N00026686',
#         'N00026460',
#         'N00045421',
#         'N00008799',
#         'N00046055',
#         'N00033539',
#         'N00038809',
#         'N00041702',
#         'N00005681',
#         'N00005818',
#         'N00038285',
#         'N00033316',
#         'N00042268',
#         'N00046067',
#         'N00044592',
#         'N00045167',
#         'N00030602',
#         'N00025219',
#         'N00041882',
#         'N00024978',
#         'N00042282',
#         'N00008122',
#         'N00025095',
#         'N00040989',
#         'N00033839',
#         'N00034349',
#         'N00006023',
#         'N00005736',
#         'N00024852',
#         'N00033085',
#         'N00046598',
#         'N00033932',
#         'N00041221',
#         'N00045812',
#         'N00000286',
#         'N00031696',
#         'N00000515',
#         'N00000528',
#         'N00009918',
#         'N00029459',
#         'N00042293',
#         'N00002147',
#         'N00039327',
#         'N00045557',
#         'N00042296',
#         'N00041418',
#         'N00036018',
#         'N00032029',
#         'N00041002',
#         'N00029891',
#         'N00033177',
#         'N00002097',
#         'N00030693',
#         'N00009759',
#         'N00031559',
#         'N00036403',
#         'N00026314',
#         'N00034453',
#         'N00038858',
#         'N00041606',
#         'N00007833',
#         'N00046320',
#         'N00007836',
#         'N00007876',
#         'N00031681',
#         'N00033814',
#         'N00041542',
#         'N00032838',
#         'N00009771',
#         'N00043379',
#         'N00033549',
#         'N00004403',
#         'N00026914',
#         'N00045434',
#         'N00036409',
#         'N00045307',
#         'N00039330',
#         'N00004367',
#         'N00032546',
#         'N00035504',
#         'N00006236',
#         'N00029788']
#     api_data = {key: open_secrets_key}
#     cids.each do |cid|
#     contributions = RestClient.get("https://www.opensecrets.org/api/?method=candContrib&cid=#{cid}&cycle=2020&apikey=#{api_data[:key]}")
#     hash = Hash.from_xml(contributions)
#     # puts hash["response"]["legislator"]
#     # legislator_array = JSON.parse(legislators)
#     hash["response"]["contributors"].each do |l|
#         Contribution.create(organization: l["org_name"], amount: l["total"], legislator_id: )
#         end
#     end
# end


legislator_set()
# contribution_set()

# legislator = Legislator.create(name: 'Gorp', party: 'republican', website_url: "google.com")

# legislator2 = Legislator.create(name: 'Thorp', party: 'democrat', website_url: "yahoo.com")

# contribution = Contribution.create(organization: "ASPCA", amount: 1000, legislator_id: 1)

# contribution2 = Contribution.create(organization: "Red Cross", amount: 1000, legislator_id: 2)

